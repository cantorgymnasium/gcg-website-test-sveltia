# You can override the included template(s) by including variable overrides
# SAST customization: https://docs.gitlab.com/ee/user/application_security/sast/#customizing-the-sast-settings
# Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
# Dependency Scanning customization: https://docs.gitlab.com/ee/user/application_security/dependency_scanning/#customizing-the-dependency-scanning-settings
# Container Scanning customization: https://docs.gitlab.com/ee/user/application_security/container_scanning/#customizing-the-container-scanning-settings
# Note that environment variables can be set in several places
# See https://docs.gitlab.com/ee/ci/variables/#cicd-variable-precedence
image: registry.gitlab.com/pages/hugo/hugo_extended:latest
variables:
  GIT_SUBMODULE_STRATEGY: recursive
deploy_website:
  before_script:
  - apk add --update --no-cache git curl
  - git config --global user.name "Denys Konovalov"
  - git config --global user.email "denys.konovalov@protonmail.com"
  script:
  - hugo --gc --minify --cleanDestinationDir
  - git clone --depth=1 --single-branch --branch main "https://x-access-token:$TOKEN@gitlab.cantorgymnasium.de/cantortechnik/website-build.git"
    /tmp/gh-pages
  - rm -rf /tmp/gh-pages/*
  - export OLD_PATH=$PWD
  - cp -r public/* /tmp/gh-pages
  - cd /tmp/gh-pages
  - git add .
  - git commit -m "$CI_COMMIT_MESSAGE"
  - git push -u origin main --force
  - cd $OLD_PATH
  - curl $host_url
  artifacts:
    expire_in: 5d
    paths:
    - public
  rules:
  - if: "$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH"
stages:
- build
- test
- deploy
- review
- dast
- staging
- canary
- production
- incremental rollout 10%
- incremental rollout 25%
- incremental rollout 50%
- incremental rollout 100%
- performance
- cleanup
sast:
  stage: test
include:
- template: Auto-DevOps.gitlab-ci.yml
